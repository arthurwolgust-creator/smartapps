<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8">
  <title>Outils MyReport ‚Äì Simulateurs</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <script src="https://cdn.tailwindcss.com"></script>
  <style>body{background:#f5f7fb}</style>
</head>
<body class="min-h-screen">
  <div class="mx-auto max-w-5xl p-6 lg:p-10">
    <header class="mb-8 rounded-2xl bg-white p-6 shadow-sm ring-1 ring-[#0075F2]/15">
      <div class="flex items-center gap-4">
        <div class="flex h-12 w-12 items-center justify-center rounded-2xl" style="background:#0075F21A">
          <span class="text-xl" style="color:#0075F2">‚àë</span>
        </div>
        <div>
          <h1 class="text-2xl font-semibold text-gray-900">Outils MyReport ‚Äì Simulateurs</h1>
          <p class="text-sm text-gray-600">Acc√©dez directement aux simulateurs et copiez le code d‚Äôint√©gration pour votre blog.</p>
        </div>
      </div>
    </header>

    <main id="app" class="grid grid-cols-1 gap-6 md:grid-cols-2"></main>

    <footer class="mt-10 text-center text-xs text-gray-500">
      H√©berg√© avec GitHub Pages ¬∑ MyReport
    </footer>
  </div>

  <script>
    // ‚öôÔ∏è Liste des simulateurs (ajoute/√©dite ici)
    // slug: sous-dossier ou fichier .html selon ton organisation
    const BASE = location.origin + location.pathname.replace(/index\.html?$/,'');
    const SIMS = [
      {
        slug: "reporting-manuel.html",
        title: "Co√ªt du reporting manuel",
        desc: "Estimez le temps et le co√ªt d‚Äôun reporting (collecte, retraitements, mise en forme)."
      },
      {
        slug: "cout-cache-ecart.html",
        title: "Co√ªt cach√© des √©carts de reporting",
        desc: "Visualisez le co√ªt cach√© des √©carts de reporting."
      },
      {
        slug: "calculateur-responsable-data.html",
        title: "Calculateur Responsable Data",
        desc: "Calculateur Responsable Data"
      },
    ];

    // Utilitaire: ID unique & propre pour l‚Äôiframe selon le slug
    function toIframeId(slug) {
      return "calc-iframe-" + String(slug||"app")
        .replace(/^https?:\/\//,'')
        .replace(/[^a-z0-9]+/gi,'-')
        .replace(/(^-|-$)/g,'')
        .toLowerCase();
    }

    function card(sim){
      const url = (sim.slug.startsWith("http") ? sim.slug : (BASE + sim.slug));
      const origin = new URL(url).origin;           // ex: https://arthurwolgust-creator.github.io
      const iframeId = toIframeId(sim.slug);
      // üîΩ EMBED complet: IFRAME + SCRIPT auto-resize (type: "calc-resize")
      const embed = `<iframe
id="${iframeId}"
src="${url}"
width="100%"
style="border:0; border-radius:16px; box-shadow:0 8px 24px rgba(0,0,0,.06)"
loading="lazy"
></iframe>
<script>
// √âcoute les messages envoy√©s par la page embarqu√©e
window.addEventListener('message', function (event) {
  // S√©curise : on accepte uniquement l'origine du simulateur
  if (event.origin !== '${origin}') return;
  if (event.data && event.data.type === 'calc-resize' && typeof event.data.height === 'number') {
    var ifr = document.getElementById('${iframeId}');
    if (ifr) { ifr.style.height = event.data.height + 'px'; }
  }
});
<\/script>`;

      // Ancien: simple iframe (on le garde pour le bouton "Copier le lien")
      const iframe = `<iframe src="${url}" width="100%" height="900" style="border:0;border-radius:16px;box-shadow:0 6px 24px rgba(0,0,0,.06)" loading="lazy" title="${sim.title}"></iframe>`;

      return `
      <div class="rounded-2xl bg-white p-5 shadow-sm ring-1 ring-gray-100">
        <div class="mb-2 text-sm font-semibold text-gray-900">${sim.title}</div>
        <p class="text-sm text-gray-600">${sim.desc}</p>
        <div class="mt-4 flex flex-wrap gap-2">
          <a href="${url}" class="inline-flex items-center justify-center rounded-xl bg-[#0075F2] px-4 py-2 text-sm font-medium text-white hover:brightness-110" target="_blank" rel="noopener">Ouvrir</a>
          <button data-url="${url}" class="copy-link inline-flex items-center justify-center rounded-xl bg-white px-4 py-2 text-sm font-medium text-[#0075F2] ring-1 ring-[#0075F2]/30 hover:bg-[#0075F2]/5">Copier le lien</button>
          <button data-embed="${encodeURIComponent(embed)}" class="copy-embed inline-flex items-center justify-center rounded-xl bg-white px-4 py-2 text-sm font-medium text-gray-800 ring-1 ring-gray-200 hover:bg-gray-50">Copier l‚Äôiframe</button>
        </div>
      </div>`;
    }

    const app = document.getElementById('app');
    app.innerHTML = SIMS.map(card).join("");

    function copy(text){
      if (navigator.clipboard && navigator.clipboard.writeText) {
        navigator.clipboard.writeText(text).then(()=>alert("Copi√© ‚úÖ")).catch(()=>fallback(text));
      } else { fallback(text); }
      function fallback(t){
        const ta=document.createElement("textarea"); ta.value=t; document.body.appendChild(ta); ta.select();
        try { document.execCommand("copy"); alert("Copi√© ‚úÖ"); } catch(e){ alert("Impossible de copier ‚Äî copie manuelle"); }
        document.body.removeChild(ta);
      }
    }

    document.querySelectorAll('.copy-link').forEach(b=>{
      b.addEventListener('click', ()=> copy(b.getAttribute('data-url')));
    });
    document.querySelectorAll('.copy-embed').forEach(b=>{
      b.addEventListener('click', ()=> copy(decodeURIComponent(b.getAttribute('data-embed'))));
    });
  </script>
</body>
</html>
